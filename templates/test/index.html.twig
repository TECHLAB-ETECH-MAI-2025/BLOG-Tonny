{% extends 'base.html.twig' %}

{% block title %}Calculatrice de taux de change{% endblock %}

{% block body %}
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold text-gray-800 text-center mb-6">
            Calculatrice de taux de change
        </h1>

        <form id="form">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Montant à convertir
                </label>
                <input type="number" id="amount" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="1" min="0" step="0.01" required>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Devises à échanger
                </label>
                <div class="flex items-center space-x-4">
                    <select id="from" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="EUR" selected>EUR</option>
                        <option value="USD">USD</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="MGA">MGA</option>
                    </select>

                    <button type="button" id="swap" class="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors">⇄</button>

                    <select id="to" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="EUR">EUR</option>
                        <option value="USD">USD</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="MGA" selected>MGA</option>
                    </select>
                </div>
            </div>

            <div class="mb-4 text-sm text-gray-600 text-center">
                Date: <span id="date"></span>
            </div>

            <div class="space-y-3">
                <button type="submit" id="convert" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                    Calculer la conversion
                </button>
            </div>
        </form>

        <div id="result" class="hidden mt-6 p-4 bg-blue-50 border border-blue-200 rounded-md">
            <div class="text-xl font-bold text-blue-800 text-center mb-2" id="resultAmount"></div>
            <div class="text-sm text-blue-600 text-center" id="resultDetails"></div>
            <div class="text-xs text-gray-500 text-center mt-2" id="reverseAmount"></div>
        </div>

        <div id="error" class="hidden mt-6 p-4 bg-red-50 border border-red-200 rounded-md">
            <div class="text-xl font-bold text-red-800 text-center mb-2">Erreur</div>
            <div class="text-sm text-red-600 text-center" id="errorMessage"></div>
        </div>
    </div>

    <script>
        document.getElementById('date').textContent = new Date().toLocaleDateString('fr-FR');

        async function convertCurrency() {
            const amount = document.getElementById('amount').value;
            const fromCurr = document.getElementById('from').value;
            const toCurr = document.getElementById('to').value;
            const convertBtn = document.getElementById('convert');

            document.getElementById('result').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            convertBtn.textContent = 'Conversion...';
            convertBtn.disabled = true;

            try {
                const response = await fetch(`/conversion?amount=${amount}&fromCurr=${fromCurr}&toCurr=${toCurr}`);
                const data = await response.json();

                document.getElementById('resultAmount').textContent =
                    `${data.conversionAmountValue} ${data.conversionFromCurrency} = ${data.reverseAmount} ${data.conversionToCurrency}`;

                document.getElementById('reverseAmount').textContent =
                    `Montant inverse: ${data.conversionAmountValue} ${data.conversionToCurrency} = ${data.convertedAmount} ${data.conversionFromCurrency}`;

                document.getElementById('result').classList.remove('hidden');

            } catch (error) {
                console.error('Erreur de conversion:', error);

                document.getElementById('errorMessage').textContent =
                    `Une erreur est survenue lors de la conversion'}`;
                document.getElementById('error').classList.remove('hidden');

            } finally {
                convertBtn.textContent = 'Calculer la conversion';
                convertBtn.disabled = false;
            }
        }

        function swapCurrencies() {
            const from = document.getElementById('from');
            const to = document.getElementById('to');
            [from.value, to.value] = [to.value, from.value];
        }

        document.getElementById('form').addEventListener('submit', (e) => {
            e.preventDefault();
            convertCurrency();
        });

        document.getElementById('swap').addEventListener('click', swapCurrencies);
    </script>
{% endblock %}